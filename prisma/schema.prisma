generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model League {
  id              String    @id @default(cuid())
  name            String
  country         String
  sportType       SportType @default(FOOTBALL)
  externalId      String?
  logoUrl         String?
  season          Int?
  isActive        Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  code            String?
  currentMatchday Int?
  matches         Match[]
  teams           Team[]

  @@unique([sportType, externalId])
  @@unique([sportType, code])
  @@index([sportType])
  @@index([country])
  @@index([code])
}

model Team {
  id            String             @id @default(cuid())
  leagueId      String
  name          String
  shortName     String?
  logoUrl       String?
  externalId    String?
  sportType     SportType          @default(FOOTBALL)
  founded       Int?
  venue         String?
  city          String?
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  clubColors    String?
  tla           String?
  homeH2H       HeadToHead[]       @relation("H2HTeamA")
  awayH2H       HeadToHead[]       @relation("H2HTeamB")
  awayMatches   Match[]            @relation("AwayTeam")
  homeMatches   Match[]            @relation("HomeTeam")
  players       Player[]
  league        League             @relation(fields: [leagueId], references: [id], onDelete: Cascade)
  recentMatches TeamRecentMatches?
  seasonStats   TeamSeasonStats?

  @@unique([sportType, externalId])
  @@index([leagueId])
  @@index([name])
  @@index([sportType])
}

model Player {
  id            String    @id @default(cuid())
  teamId        String
  name          String
  position      String?
  nationality   String?
  birthDate     DateTime?
  photoUrl      String?
  externalId    String?   @unique
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  contractEnd   DateTime?
  contractStart DateTime?
  firstName     String?
  lastName      String?
  marketValue   Int?
  shirtNumber   Int?
  team          Team      @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@index([teamId])
  @@index([name])
  @@index([position])
}

model Match {
  id            String         @id @default(cuid())
  leagueId      String
  homeTeamId    String
  awayTeamId    String
  sportType     SportType      @default(FOOTBALL)
  kickoffAt     DateTime
  status        MatchStatus    @default(SCHEDULED)
  homeScore     Int?
  awayScore     Int?
  round         String?
  venue         String?
  slug          String?        @unique
  externalId    String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  halfTimeAway  Int?
  halfTimeHome  Int?
  matchday      Int?
  stage         String?
  awayTeam      Team           @relation("AwayTeam", fields: [awayTeamId], references: [id], onDelete: Cascade)
  homeTeam      Team           @relation("HomeTeam", fields: [homeTeamId], references: [id], onDelete: Cascade)
  league        League         @relation(fields: [leagueId], references: [id], onDelete: Cascade)
  matchAnalysis MatchAnalysis?
  matchStats    MatchStats?

  @@unique([sportType, externalId])
  @@index([leagueId])
  @@index([kickoffAt])
  @@index([status])
  @@index([homeTeamId])
  @@index([awayTeamId])
  @@index([sportType])
  @@index([matchday])
}

model MatchStats {
  id        String   @id @default(cuid())
  matchId   String   @unique
  statsJson Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  match     Match    @relation(fields: [matchId], references: [id], onDelete: Cascade)
}

model TeamSeasonStats {
  id               String    @id @default(cuid())
  teamId           String    @unique
  sportType        SportType @default(FOOTBALL)
  season           Int
  gamesPlayed      Int       @default(0)
  wins             Int       @default(0)
  draws            Int?
  losses           Int       @default(0)
  rank             Int?
  points           Int?
  goalsFor         Int?
  goalsAgainst     Int?
  pointsScored     Float?
  pointsAllowed    Float?
  homeGames        Int       @default(0)
  homeWins         Int       @default(0)
  homeAvgFor       Float?
  homeAvgAgainst   Float?
  awayGames        Int       @default(0)
  awayWins         Int       @default(0)
  awayAvgFor       Float?
  awayAvgAgainst   Float?
  additionalStats  Json?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  awayDraws        Int?
  awayGoalsAgainst Int?
  awayGoalsFor     Int?
  awayLosses       Int?
  form             String?
  goalDifference   Int?
  homeDraws        Int?
  homeGoalsAgainst Int?
  homeGoalsFor     Int?
  homeLosses       Int?
  team             Team      @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@index([sportType])
  @@index([season])
}

model TeamRecentMatches {
  id          String    @id @default(cuid())
  teamId      String    @unique
  sportType   SportType @default(FOOTBALL)
  matchesJson Json
  recentForm  String?
  updatedAt   DateTime  @updatedAt
  createdAt   DateTime  @default(now())
  team        Team      @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@index([sportType])
}

model HeadToHead {
  id          String    @id @default(cuid())
  teamAId     String
  teamBId     String
  sportType   SportType @default(FOOTBALL)
  matchesJson Json
  updatedAt   DateTime  @updatedAt
  createdAt   DateTime  @default(now())
  teamA       Team      @relation("H2HTeamA", fields: [teamAId], references: [id], onDelete: Cascade)
  teamB       Team      @relation("H2HTeamB", fields: [teamBId], references: [id], onDelete: Cascade)

  @@unique([teamAId, teamBId])
  @@index([sportType])
}

model MatchAnalysis {
  id                String   @id @default(cuid())
  matchId           String   @unique
  inputDataSnapshot Json?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  translations      Json?
  match             Match    @relation(fields: [matchId], references: [id], onDelete: Cascade)
}

model DailyReport {
  id           String    @id @default(cuid())
  date         DateTime  @db.Date
  sportType    SportType @default(FOOTBALL)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  translations Json?

  @@unique([date, sportType])
  @@index([date])
  @@index([sportType])
}

model News {
  id           String    @id @default(cuid())
  link         String    @unique
  relatedTeams Json?
  sportType    SportType @default(FOOTBALL)
  imageUrl     String?
  source       String?
  publishedAt  DateTime
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  translations Json?

  @@index([publishedAt])
  @@index([sportType])
}

model SchedulerLog {
  id         String   @id @default(cuid())
  jobName    String
  executedAt DateTime @default(now())
  result     String
  details    Json?
  duration   Int?
  apiCalls   Int?
  createdAt  DateTime @default(now())

  @@index([jobName])
  @@index([executedAt])
}

model ApiCallLog {
  id       String   @id @default(cuid())
  apiType  String
  endpoint String
  calledAt DateTime @default(now())
  success  Boolean  @default(true)
  response Json?

  @@index([apiType])
  @@index([calledAt])
}

enum SportType {
  FOOTBALL
  BASKETBALL
  BASEBALL
}

enum MatchStatus {
  SCHEDULED
  LIVE
  FINISHED
  POSTPONED
  CANCELLED
  TIMED
  SUSPENDED
}
