name: Data Collection Cron Jobs

on:
  schedule:
    # Football: ë§¤ì¼ 01:00 UTC (KST 10:00)
    - cron: '0 1 * * *'
    # Basketball: ë§¤ì¼ 02:00 UTC (KST 11:00)
    - cron: '0 2 * * *'
    # Baseball: ë§¤ì¼ 03:00 UTC (KST 12:00)
    - cron: '0 3 * * *'
  workflow_dispatch:
    inputs:
      sport:
        description: 'Sport to collect data for'
        required: true
        default: 'all'
        type: choice
        options:
          - all
          - football
          - basketball
          - baseball

jobs:
  # =====================================================
  # FOOTBALL JOBS
  # =====================================================
  football-collect-matches:
    name: Football - Collect Matches
    runs-on: ubuntu-latest
    if: |
      github.event_name == 'workflow_dispatch' &&
      (github.event.inputs.sport == 'football' || github.event.inputs.sport == 'all') ||
      github.event.schedule == '0 1 * * *'
    steps:
      - name: Collect Football Matches
        run: |
          curl -X GET "${{ secrets.SITE_URL }}/api/cron/collect-football" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            --fail --silent --show-error

  football-collect-team-data:
    name: Football - Collect Team Data
    runs-on: ubuntu-latest
    needs: [football-collect-matches]
    if: |
      github.event_name == 'workflow_dispatch' &&
      (github.event.inputs.sport == 'football' || github.event.inputs.sport == 'all') ||
      github.event.schedule == '0 1 * * *'
    steps:
      - name: Wait for rate limit
        run: sleep 15

      - name: Collect Football Team Data
        run: |
          curl -X GET "${{ secrets.SITE_URL }}/api/cron/collect-team-data?sport=football" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            --fail --silent --show-error

  football-generate-analysis:
    name: Football - Generate Analysis
    runs-on: ubuntu-latest
    needs: [football-collect-team-data]
    if: |
      github.event_name == 'workflow_dispatch' &&
      (github.event.inputs.sport == 'football' || github.event.inputs.sport == 'all') ||
      github.event.schedule == '0 1 * * *'
    steps:
      - name: Wait for rate limit
        run: sleep 15

      - name: Generate Football Analysis
        run: |
          curl -X GET "${{ secrets.SITE_URL }}/api/cron/generate-analysis?sport=football" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            --fail --silent --show-error

  football-generate-daily-report:
    name: Football - Generate Daily Report
    runs-on: ubuntu-latest
    needs: [football-generate-analysis]
    if: |
      github.event_name == 'workflow_dispatch' &&
      (github.event.inputs.sport == 'football' || github.event.inputs.sport == 'all') ||
      github.event.schedule == '0 1 * * *'
    steps:
      - name: Wait for rate limit
        run: sleep 15

      - name: Generate Football Daily Report
        run: |
          curl -X GET "${{ secrets.SITE_URL }}/api/cron/generate-daily-report?sport=football" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            --fail --silent --show-error

  football-update-live-matches:
    name: Football - Update Live Matches
    runs-on: ubuntu-latest
    needs: [football-generate-daily-report]
    if: |
      github.event_name == 'workflow_dispatch' &&
      (github.event.inputs.sport == 'football' || github.event.inputs.sport == 'all') ||
      github.event.schedule == '0 1 * * *'
    steps:
      - name: Wait for rate limit
        run: sleep 15

      - name: Update Football Live Matches
        run: |
          curl -X GET "${{ secrets.SITE_URL }}/api/cron/update-live-matches?sport=football" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            --fail --silent --show-error

  # =====================================================
  # BASKETBALL JOBS
  # =====================================================
  basketball-collect-matches:
    name: Basketball - Collect Matches
    runs-on: ubuntu-latest
    if: |
      github.event_name == 'workflow_dispatch' &&
      (github.event.inputs.sport == 'basketball' || github.event.inputs.sport == 'all') ||
      github.event.schedule == '0 2 * * *'
    steps:
      - name: Collect Basketball Matches
        run: |
          curl -X GET "${{ secrets.SITE_URL }}/api/cron/collect-basketball" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            --fail --silent --show-error

  basketball-collect-team-data:
    name: Basketball - Collect Team Data
    runs-on: ubuntu-latest
    needs: [basketball-collect-matches]
    if: |
      github.event_name == 'workflow_dispatch' &&
      (github.event.inputs.sport == 'basketball' || github.event.inputs.sport == 'all') ||
      github.event.schedule == '0 2 * * *'
    steps:
      - name: Wait for rate limit
        run: sleep 15

      - name: Collect Basketball Team Data
        run: |
          curl -X GET "${{ secrets.SITE_URL }}/api/cron/collect-team-data?sport=basketball" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            --fail --silent --show-error

  basketball-generate-analysis:
    name: Basketball - Generate Analysis
    runs-on: ubuntu-latest
    needs: [basketball-collect-team-data]
    if: |
      github.event_name == 'workflow_dispatch' &&
      (github.event.inputs.sport == 'basketball' || github.event.inputs.sport == 'all') ||
      github.event.schedule == '0 2 * * *'
    steps:
      - name: Wait for rate limit
        run: sleep 15

      - name: Generate Basketball Analysis
        run: |
          curl -X GET "${{ secrets.SITE_URL }}/api/cron/generate-analysis?sport=basketball" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            --fail --silent --show-error

  basketball-generate-daily-report:
    name: Basketball - Generate Daily Report
    runs-on: ubuntu-latest
    needs: [basketball-generate-analysis]
    if: |
      github.event_name == 'workflow_dispatch' &&
      (github.event.inputs.sport == 'basketball' || github.event.inputs.sport == 'all') ||
      github.event.schedule == '0 2 * * *'
    steps:
      - name: Wait for rate limit
        run: sleep 15

      - name: Generate Basketball Daily Report
        run: |
          curl -X GET "${{ secrets.SITE_URL }}/api/cron/generate-daily-report?sport=basketball" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            --fail --silent --show-error

  basketball-update-live-matches:
    name: Basketball - Update Live Matches
    runs-on: ubuntu-latest
    needs: [basketball-generate-daily-report]
    if: |
      github.event_name == 'workflow_dispatch' &&
      (github.event.inputs.sport == 'basketball' || github.event.inputs.sport == 'all') ||
      github.event.schedule == '0 2 * * *'
    steps:
      - name: Wait for rate limit
        run: sleep 15

      - name: Update Basketball Live Matches
        run: |
          curl -X GET "${{ secrets.SITE_URL }}/api/cron/update-live-matches?sport=basketball" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            --fail --silent --show-error

  # =====================================================
  # BASEBALL JOBS
  # =====================================================
  baseball-collect-matches:
    name: Baseball - Collect Matches
    runs-on: ubuntu-latest
    if: |
      github.event_name == 'workflow_dispatch' &&
      (github.event.inputs.sport == 'baseball' || github.event.inputs.sport == 'all') ||
      github.event.schedule == '0 3 * * *'
    steps:
      - name: Collect Baseball Matches
        run: |
          curl -X GET "${{ secrets.SITE_URL }}/api/cron/collect-baseball" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            --fail --silent --show-error

  baseball-collect-team-data:
    name: Baseball - Collect Team Data
    runs-on: ubuntu-latest
    needs: [baseball-collect-matches]
    if: |
      github.event_name == 'workflow_dispatch' &&
      (github.event.inputs.sport == 'baseball' || github.event.inputs.sport == 'all') ||
      github.event.schedule == '0 3 * * *'
    steps:
      - name: Wait for rate limit
        run: sleep 15

      - name: Collect Baseball Team Data
        run: |
          curl -X GET "${{ secrets.SITE_URL }}/api/cron/collect-team-data?sport=baseball" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            --fail --silent --show-error

  baseball-generate-analysis:
    name: Baseball - Generate Analysis
    runs-on: ubuntu-latest
    needs: [baseball-collect-team-data]
    if: |
      github.event_name == 'workflow_dispatch' &&
      (github.event.inputs.sport == 'baseball' || github.event.inputs.sport == 'all') ||
      github.event.schedule == '0 3 * * *'
    steps:
      - name: Wait for rate limit
        run: sleep 15

      - name: Generate Baseball Analysis
        run: |
          curl -X GET "${{ secrets.SITE_URL }}/api/cron/generate-analysis?sport=baseball" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            --fail --silent --show-error

  baseball-generate-daily-report:
    name: Baseball - Generate Daily Report
    runs-on: ubuntu-latest
    needs: [baseball-generate-analysis]
    if: |
      github.event_name == 'workflow_dispatch' &&
      (github.event.inputs.sport == 'baseball' || github.event.inputs.sport == 'all') ||
      github.event.schedule == '0 3 * * *'
    steps:
      - name: Wait for rate limit
        run: sleep 15

      - name: Generate Baseball Daily Report
        run: |
          curl -X GET "${{ secrets.SITE_URL }}/api/cron/generate-daily-report?sport=baseball" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            --fail --silent --show-error

  baseball-update-live-matches:
    name: Baseball - Update Live Matches
    runs-on: ubuntu-latest
    needs: [baseball-generate-daily-report]
    if: |
      github.event_name == 'workflow_dispatch' &&
      (github.event.inputs.sport == 'baseball' || github.event.inputs.sport == 'all') ||
      github.event.schedule == '0 3 * * *'
    steps:
      - name: Wait for rate limit
        run: sleep 15

      - name: Update Baseball Live Matches
        run: |
          curl -X GET "${{ secrets.SITE_URL }}/api/cron/update-live-matches?sport=baseball" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            --fail --silent --show-error

  # =====================================================
  # SUMMARY
  # =====================================================
  notify-completion:
    name: Workflow Summary
    runs-on: ubuntu-latest
    needs:
      - football-collect-matches
      - football-collect-team-data
      - football-generate-analysis
      - football-generate-daily-report
      - football-update-live-matches
      - basketball-collect-matches
      - basketball-collect-team-data
      - basketball-generate-analysis
      - basketball-generate-daily-report
      - basketball-update-live-matches
      - baseball-collect-matches
      - baseball-collect-team-data
      - baseball-generate-analysis
      - baseball-generate-daily-report
      - baseball-update-live-matches
    if: always()
    steps:
      - name: Summary
        run: |
          echo "# ðŸŸï¸ Data Collection Workflow Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## âš½ Football" >> $GITHUB_STEP_SUMMARY
          echo "- Collect Matches: ${{ needs.football-collect-matches.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Collect Team Data: ${{ needs.football-collect-team-data.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Generate Analysis: ${{ needs.football-generate-analysis.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Generate Daily Report: ${{ needs.football-generate-daily-report.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Update Live Matches: ${{ needs.football-update-live-matches.result }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## ðŸ€ Basketball" >> $GITHUB_STEP_SUMMARY
          echo "- Collect Matches: ${{ needs.basketball-collect-matches.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Collect Team Data: ${{ needs.basketball-collect-team-data.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Generate Analysis: ${{ needs.basketball-generate-analysis.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Generate Daily Report: ${{ needs.basketball-generate-daily-report.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Update Live Matches: ${{ needs.basketball-update-live-matches.result }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## âš¾ Baseball" >> $GITHUB_STEP_SUMMARY
          echo "- Collect Matches: ${{ needs.baseball-collect-matches.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Collect Team Data: ${{ needs.baseball-collect-team-data.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Generate Analysis: ${{ needs.baseball-generate-analysis.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Generate Daily Report: ${{ needs.baseball-generate-daily-report.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Update Live Matches: ${{ needs.baseball-update-live-matches.result }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Timestamp**: $(date -u)" >> $GITHUB_STEP_SUMMARY
